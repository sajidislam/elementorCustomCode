add_action('elementor_pro/forms/validation', function ($record, $ajax_handler) {
    // Retrieve the email field from the form
    $fields = $record->get_field(['id' => 'email']); // Assuming the email field ID is 'email'

    // Return if the email field isn't found
    if (empty($fields)) {
        return;
    }

    $field = current($fields);

    // Validate email format
    if (!filter_var($field['value'], FILTER_VALIDATE_EMAIL)) {
        $ajax_handler->add_error($field['id'], 'Invalid email format.');
        return;
    }

    // Split email to get domain
    $email_parts = explode('@', $field['value']);
    $domain = end($email_parts);

    // Validate email domain
    if (!checkdnsrr($domain, 'MX')) {
        $ajax_handler->add_error($field['id'], 'Invalid email domain. Please use a valid email address.');
    }
}, 10, 2);
